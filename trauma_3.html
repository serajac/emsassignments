<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comprehensive Trauma Assessment - 50 Questions</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .welcome-screen,
        .test-content,
        .results-screen {
            padding: 40px;
        }

        .welcome-screen h2 {
            color: #1e3c72;
            margin-bottom: 20px;
            font-size: 2rem;
        }

        .welcome-screen p {
            color: #555;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .name-input {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
            transition: border-color 0.3s;
        }

        .name-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .progress-bar {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 30px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .question-number {
            color: #667eea;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .question-text {
            font-size: 1.3rem;
            color: #2c3e50;
            margin-bottom: 25px;
            font-weight: 600;
            line-height: 1.5;
        }

        .option {
            background: white;
            padding: 15px 20px;
            margin: 10px 0;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }

        .option.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .option input[type="checkbox"],
        .option input[type="radio"] {
            margin-right: 12px;
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .matching-column {
            background: white;
            padding: 20px;
            border-radius: 8px;
        }

        .matching-item {
            padding: 12px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 6px;
            border: 2px solid #e0e0e0;
        }

        .matching-select {
            width: 100%;
            padding: 8px;
            margin-top: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
        }

        .sequence-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
        }

        .sequence-item {
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            cursor: move;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .sequence-number {
            background: #667eea;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }

        .fill-blank-input {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            margin: 5px;
            min-width: 150px;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .results-summary {
            text-align: center;
            margin: 40px 0;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 30px auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .score-circle .score {
            font-size: 3.5rem;
            font-weight: 700;
        }

        .score-circle .label {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .results-details {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            margin: 10px 0;
            background: white;
            border-radius: 8px;
        }

        .certificate-preview {
            border: 3px solid #667eea;
            padding: 40px;
            margin: 30px 0;
            text-align: center;
            background: white;
            border-radius: 12px;
        }

        .certificate-title {
            font-size: 2.5rem;
            color: #1e3c72;
            margin: 20px 0;
            font-weight: 700;
        }

        .certificate-text {
            font-size: 1.2rem;
            margin: 15px 0;
            color: #555;
        }

        .certificate-name {
            font-size: 2rem;
            color: #667eea;
            font-weight: 700;
            margin: 20px 0;
            text-transform: uppercase;
        }

        .alert {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .matching-container {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .question-text {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const questions = [
            // Multiple Choice Questions (1-20)
            {
                id: 1,
                type: "multiple-choice",
                question: "What are the three types of muscle tissue in the human body?",
                options: [
                    "Cardiac, skeletal, smooth",
                    "Striated, non-striated, voluntary",
                    "Voluntary, involuntary, mixed",
                    "Fast-twitch, slow-twitch, intermediate"
                ],
                correct: 0
            },
            {
                id: 2,
                type: "multiple-choice",
                question: "What is the primary function of the periosteum?",
                options: [
                    "To produce red blood cells",
                    "To cover the outer portion of the bone",
                    "To connect muscles to bones",
                    "To lubricate joints"
                ],
                correct: 1
            },
            {
                id: 3,
                type: "multiple-choice",
                question: "Which structure connects skeletal muscle to bone?",
                options: [
                    "Ligaments",
                    "Cartilage",
                    "Tendons",
                    "Fascia"
                ],
                correct: 2
            },
            {
                id: 4,
                type: "multiple-choice",
                question: "At what age does bone density typically begin to decrease?",
                options: [
                    "25 years",
                    "35 years",
                    "45 years",
                    "55 years"
                ],
                correct: 1
            },
            {
                id: 5,
                type: "multiple-choice",
                question: "What is a pathologic fracture?",
                options: [
                    "A fracture caused by direct trauma",
                    "A fracture where a medical condition causes the bone to become abnormally weak",
                    "A fracture that occurs during physical activity",
                    "A fracture with an open wound"
                ],
                correct: 1
            },
            {
                id: 6,
                type: "multiple-choice",
                question: "Which type of fracture has broken skin over the fracture site?",
                options: [
                    "Closed fracture",
                    "Open fracture",
                    "Greenstick fracture",
                    "Comminuted fracture"
                ],
                correct: 1
            },
            {
                id: 7,
                type: "multiple-choice",
                question: "What is crepitus?",
                options: [
                    "Swelling around a joint",
                    "Grating sound or feeling of broken bones",
                    "Discoloration of the skin",
                    "Loss of pulse distal to injury"
                ],
                correct: 1
            },
            {
                id: 8,
                type: "multiple-choice",
                question: "What is a subluxation?",
                options: [
                    "Complete dislocation of a joint",
                    "Partial dislocation of a joint",
                    "A torn ligament",
                    "A muscle strain"
                ],
                correct: 1
            },
            {
                id: 9,
                type: "multiple-choice",
                question: "What does RICE stand for in acute injury management?",
                options: [
                    "Rest, Ice, Compression, Elevation",
                    "Reduce, Immobilize, Cool, Examine",
                    "Restrict, Ice, Contain, Elevate",
                    "Rest, Immobilize, Compress, Evaluate"
                ],
                correct: 0
            },
            {
                id: 10,
                type: "multiple-choice",
                question: "What is the normal core body temperature range?",
                options: [
                    "96¬∞F - 99¬∞F",
                    "97¬∞F - 100¬∞F",
                    "98.6¬∞F (must be exact)",
                    "Must be maintained within a narrow range for body chemistry to work efficiently"
                ],
                correct: 3
            },
            {
                id: 11,
                type: "multiple-choice",
                question: "What is hypothermia?",
                options: [
                    "Elevated body temperature above 100¬∞F",
                    "Core body temperature falls due to inadequate heat production or excess cold stress",
                    "Localized cold injury to extremities",
                    "Temporary decrease in body temperature during sleep"
                ],
                correct: 1
            },
            {
                id: 12,
                type: "multiple-choice",
                question: "Which of the following is NOT a mechanism of heat loss?",
                options: [
                    "Conduction",
                    "Radiation",
                    "Absorption",
                    "Evaporation"
                ],
                correct: 2
            },
            {
                id: 13,
                type: "multiple-choice",
                question: "What characterizes frostbite?",
                options: [
                    "Tissues are cold but not frozen",
                    "Tissues are frozen and cells are permanently damaged",
                    "Temporary numbness without tissue damage",
                    "Mild cold exposure with reversible effects"
                ],
                correct: 1
            },
            {
                id: 14,
                type: "multiple-choice",
                question: "Which body parts are most commonly affected by frostnip?",
                options: [
                    "Chest and abdomen",
                    "Thighs and calves",
                    "Ears, nose, and fingers",
                    "Back and shoulders"
                ],
                correct: 2
            },
            {
                id: 15,
                type: "multiple-choice",
                question: "What is the core body temperature range for mild hypothermia?",
                options: [
                    "85¬∞F - 90¬∞F",
                    "90¬∞F - 95¬∞F",
                    "95¬∞F - 98¬∞F",
                    "Below 85¬∞F"
                ],
                correct: 1
            },
            {
                id: 16,
                type: "multiple-choice",
                question: "What should be avoided during the initial 48-72 hours after a musculoskeletal injury?",
                options: [
                    "Cold therapy",
                    "Elevation",
                    "Heat therapy",
                    "Immobilization"
                ],
                correct: 2
            },
            {
                id: 17,
                type: "multiple-choice",
                question: "Traction splints are primarily used for which type of fracture?",
                options: [
                    "Upper arm fractures",
                    "Midshaft femur fractures",
                    "Lower leg fractures",
                    "Pelvic fractures"
                ],
                correct: 1
            },
            {
                id: 18,
                type: "multiple-choice",
                question: "What is immersion foot caused by?",
                options: [
                    "Direct contact with ice",
                    "Prolonged exposure to cold water",
                    "Sudden temperature changes",
                    "High altitude exposure"
                ],
                correct: 1
            },
            {
                id: 19,
                type: "multiple-choice",
                question: "When should neurovascular status be assessed after splinting?",
                options: [
                    "Only once immediately after splinting",
                    "Every 30 minutes",
                    "Every 5 to 10 minutes",
                    "Only if the patient complains"
                ],
                correct: 2
            },
            {
                id: 20,
                type: "multiple-choice",
                question: "What is the correct fluid administration for musculoskeletal injuries?",
                options: [
                    "10 mL/kg increments",
                    "20 mL/kg increments",
                    "50 mL/kg bolus",
                    "Continuous infusion"
                ],
                correct: 1
            },

            // True/False Questions (21-30)
            {
                id: 21,
                type: "true-false",
                question: "Osteoporosis is associated with a higher risk of fractures.",
                correct: true
            },
            {
                id: 22,
                type: "true-false",
                question: "Ligaments connect skeletal muscle to bone.",
                correct: false
            },
            {
                id: 23,
                type: "true-false",
                question: "A greenstick fracture is an incomplete fracture commonly seen in children.",
                correct: true
            },
            {
                id: 24,
                type: "true-false",
                question: "An open fracture has intact skin over the fracture site.",
                correct: false
            },
            {
                id: 25,
                type: "true-false",
                question: "Traction splints should be used for injuries involving the knee.",
                correct: false
            },
            {
                id: 26,
                type: "true-false",
                question: "Passive rewarming is appropriate for treating mild hypothermia.",
                correct: true
            },
            {
                id: 27,
                type: "true-false",
                question: "Frostnip is painful when it occurs.",
                correct: false
            },
            {
                id: 28,
                type: "true-false",
                question: "Active rewarming of extremities should be done before rewarming the core in severe hypothermia.",
                correct: false
            },
            {
                id: 29,
                type: "true-false",
                question: "Convection is one of the mechanisms by which the body loses heat.",
                correct: true
            },
            {
                id: 30,
                type: "true-false",
                question: "A patient with a musculoskeletal injury should always walk to maintain circulation.",
                correct: false
            },

            // Multiple Select Questions (31-35)
            {
                id: 31,
                type: "multiple-select",
                question: "Which of the following are signs and symptoms of a fracture? (Select all that apply)",
                options: [
                    "Deformity",
                    "Swelling",
                    "Crepitus",
                    "Hypertension",
                    "Ecchymosis"
                ],
                correct: [0, 1, 2, 4]
            },
            {
                id: 32,
                type: "multiple-select",
                question: "Which are mechanisms of heat loss from the body? (Select all that apply)",
                options: [
                    "Conduction",
                    "Radiation",
                    "Evaporation",
                    "Photosynthesis",
                    "Respiration"
                ],
                correct: [0, 1, 2, 4]
            },
            {
                id: 33,
                type: "multiple-select",
                question: "Which conditions are contraindications for PASG use? (Select all that apply)",
                options: [
                    "Pregnancy",
                    "Pulmonary edema",
                    "Penetrating chest injuries",
                    "Femur fracture",
                    "Groin injuries"
                ],
                correct: [0, 1, 2, 4]
            },
            {
                id: 34,
                type: "multiple-select",
                question: "What should be done to prevent further cold injury? (Select all that apply)",
                options: [
                    "Remove wet clothing",
                    "Insulate exposed body parts",
                    "Prevent convection heat loss",
                    "Give cold fluids",
                    "Keep patient dry"
                ],
                correct: [0, 1, 2, 4]
            },
            {
                id: 35,
                type: "multiple-select",
                question: "Which are types of fractures? (Select all that apply)",
                options: [
                    "Transverse",
                    "Oblique",
                    "Spiral",
                    "Circular",
                    "Comminuted"
                ],
                correct: [0, 1, 2, 4]
            },

            // Matching Questions (36-38)
            {
                id: 36,
                type: "matching",
                question: "Match the bone structure to its description:",
                pairs: [
                    { left: "Diaphysis", right: "Shaft of long bone" },
                    { left: "Epiphysis", right: "End of long bone" },
                    { left: "Periosteum", right: "Outer covering of bone" },
                    { left: "Metaphysis", right: "Region between shaft and end" }
                ]
            },
            {
                id: 37,
                type: "matching",
                question: "Match the injury type to its definition:",
                pairs: [
                    { left: "Sprain", right: "Ligament is stretched or torn" },
                    { left: "Strain", right: "Muscle/tendon injury from violent contraction" },
                    { left: "Dislocation", right: "Bone totally displaced from joint" },
                    { left: "Fracture", right: "Break in bone continuity" }
                ]
            },
            {
                id: 38,
                type: "matching",
                question: "Match the cold injury to its characteristics:",
                pairs: [
                    { left: "Frostnip", right: "Affects ears, nose, fingers; not painful" },
                    { left: "Frostbite", right: "Tissues frozen; hard waxy feel" },
                    { left: "Immersion foot", right: "From prolonged cold water exposure" },
                    { left: "Hypothermia", right: "Core temperature below normal" }
                ]
            },

            // Sequence Questions (39-41)
            {
                id: 39,
                type: "sequence",
                question: "Place the following steps in the correct order for primary survey:",
                items: [
                    "Check responsiveness using AVPU",
                    "Address exsanguinating hemorrhage",
                    "Assess airway and breathing",
                    "Assess circulation and treat for shock"
                ],
                correctOrder: [1, 0, 2, 3]
            },
            {
                id: 40,
                type: "sequence",
                question: "Arrange the stages of hypothermia from least to most severe:",
                items: [
                    "Severe hypothermia (below 82¬∞F)",
                    "Mild hypothermia (90-95¬∞F)",
                    "Profound hypothermia (below 68¬∞F)",
                    "Moderate hypothermia (82-90¬∞F)"
                ],
                correctOrder: [1, 3, 0, 2]
            },
            {
                id: 41,
                type: "sequence",
                question: "Order the components of RICE therapy:",
                items: [
                    "Compression",
                    "Ice",
                    "Rest",
                    "Elevation"
                ],
                correctOrder: [2, 1, 0, 3]
            },

            // Fill in the Blank Questions (42-50)
            {
                id: 42,
                type: "fill-blank",
                question: "The ________ skeleton includes bones of the central part of the body, while the ________ skeleton includes the upper and lower extremities.",
                blanks: ["axial", "appendicular"]
            },
            {
                id: 43,
                type: "fill-blank",
                question: "________ connect bone to bone, while ________ connect muscle to bone.",
                blanks: ["ligaments", "tendons"]
            },
            {
                id: 44,
                type: "fill-blank",
                question: "A ________ fracture is one where the bone is misaligned, while a ________ fracture is a simple crack with no displacement.",
                blanks: ["displaced", "nondisplaced"]
            },
            {
                id: 45,
                type: "fill-blank",
                question: "The ability of the body to maintain temperature balance is called ________.",
                blanks: ["thermoregulation"]
            },
            {
                id: 46,
                type: "fill-blank",
                question: "A ________ is the combination of a muscle and the neuron that innervates it.",
                blanks: ["motor unit"]
            },
            {
                id: 47,
                type: "fill-blank",
                question: "________ are useful for treating musculoskeletal injuries during the initial 48 hours, while ________ should be avoided during this period.",
                blanks: ["cold packs", "heat therapy"]
            },
            {
                id: 48,
                type: "fill-blank",
                question: "The process of heat production is called ________, while heat loss is called ________.",
                blanks: ["thermogenesis", "thermolysis"]
            },
            {
                id: 49,
                type: "fill-blank",
                question: "Traction splints are contraindicated for injuries involving the ________, ________, or partial amputations.",
                blanks: ["knee", "pelvis"]
            },
            {
                id: 50,
                type: "fill-blank",
                question: "In cold injury management, the patient should receive warm, ________ oxygen and ________ fluids when possible.",
                blanks: ["humidified", "warmed"]
            }
        ];

        function TraumaTest() {
            const [stage, setStage] = useState('welcome'); // welcome, test, results
            const [studentName, setStudentName] = useState('');
            const [currentQuestion, setCurrentQuestion] = useState(0);
            const [answers, setAnswers] = useState({});
            const [score, setScore] = useState(0);
            const [showValidation, setShowValidation] = useState(false);

            const handleStartTest = () => {
                if (studentName.trim()) {
                    setStage('test');
                } else {
                    alert('Please enter your name to begin the test.');
                }
            };

            const handleAnswer = (questionId, answer) => {
                setAnswers({ ...answers, [questionId]: answer });
                setShowValidation(false);
            };

            const handleNext = () => {
                const question = questions[currentQuestion];
                if (!answers[question.id]) {
                    setShowValidation(true);
                    return;
                }
                
                if (currentQuestion < questions.length - 1) {
                    setCurrentQuestion(currentQuestion + 1);
                    setShowValidation(false);
                } else {
                    calculateScore();
                }
            };

            const handlePrevious = () => {
                if (currentQuestion > 0) {
                    setCurrentQuestion(currentQuestion - 1);
                    setShowValidation(false);
                }
            };

            const calculateScore = () => {
                let correct = 0;
                questions.forEach(question => {
                    const answer = answers[question.id];
                    
                    if (question.type === 'multiple-choice' || question.type === 'true-false') {
                        if (answer === question.correct) correct++;
                    } else if (question.type === 'multiple-select') {
                        if (JSON.stringify(answer?.sort()) === JSON.stringify(question.correct.sort())) {
                            correct++;
                        }
                    } else if (question.type === 'matching') {
                        let allCorrect = true;
                        question.pairs.forEach((pair, idx) => {
                            if (answer?.[idx] !== pair.right) allCorrect = false;
                        });
                        if (allCorrect) correct++;
                    } else if (question.type === 'sequence') {
                        if (JSON.stringify(answer) === JSON.stringify(question.correctOrder)) {
                            correct++;
                        }
                    } else if (question.type === 'fill-blank') {
                        let allCorrect = true;
                        question.blanks.forEach((blank, idx) => {
                            const userAnswer = answer?.[idx]?.toLowerCase().trim();
                            const correctAnswer = blank.toLowerCase().trim();
                            if (userAnswer !== correctAnswer) allCorrect = false;
                        });
                        if (allCorrect) correct++;
                    }
                });
                
                setScore(correct);
                setStage('results');
            };

            const downloadCertificate = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF({
                    orientation: 'landscape',
                    unit: 'mm',
                    format: 'a4'
                });

                // Background
                doc.setFillColor(240, 248, 255);
                doc.rect(0, 0, 297, 210, 'F');

                // Border
                doc.setDrawColor(102, 126, 234);
                doc.setLineWidth(2);
                doc.rect(10, 10, 277, 190);
                doc.setLineWidth(0.5);
                doc.rect(15, 15, 267, 180);

                // Title
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(36);
                doc.setTextColor(30, 60, 114);
                doc.text('CERTIFICATE OF COMPLETION', 148.5, 50, { align: 'center' });

                // Subtitle
                doc.setFontSize(18);
                doc.setTextColor(102, 126, 234);
                doc.text('Comprehensive Trauma Assessment', 148.5, 65, { align: 'center' });

                // Body text
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(14);
                doc.setTextColor(85, 85, 85);
                doc.text('This certifies that', 148.5, 85, { align: 'center' });

                // Student name
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(28);
                doc.setTextColor(102, 126, 234);
                doc.text(studentName.toUpperCase(), 148.5, 105, { align: 'center' });

                // Completion text
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(14);
                doc.setTextColor(85, 85, 85);
                doc.text('has successfully completed the 50-question', 148.5, 125, { align: 'center' });
                doc.text('Trauma Assessment covering Orthopaedic Injuries and Environmental Emergencies', 148.5, 135, { align: 'center' });

                // Score
                doc.setFont('helvetica', 'bold');
                doc.setFontSize(18);
                doc.setTextColor(30, 60, 114);
                doc.text(`Score: ${score}/50 (${Math.round((score/50)*100)}%)`, 148.5, 155, { align: 'center' });

                // Date
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(12);
                doc.setTextColor(85, 85, 85);
                const today = new Date().toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                doc.text(`Date: ${today}`, 148.5, 175, { align: 'center' });

                // Footer
                doc.setFontSize(10);
                doc.setTextColor(150, 150, 150);
                doc.text('CAMP Community College - Emergency Medical Services', 148.5, 190, { align: 'center' });

                doc.save(`Trauma_Certificate_${studentName.replace(/\s+/g, '_')}.pdf`);
            };

            const renderQuestion = () => {
                const question = questions[currentQuestion];

                switch (question.type) {
                    case 'multiple-choice':
                        return (
                            <div>
                                {question.options.map((option, idx) => (
                                    <div
                                        key={idx}
                                        className={`option ${answers[question.id] === idx ? 'selected' : ''}`}
                                        onClick={() => handleAnswer(question.id, idx)}
                                    >
                                        <input
                                            type="radio"
                                            checked={answers[question.id] === idx}
                                            onChange={() => {}}
                                        />
                                        <span>{option}</span>
                                    </div>
                                ))}
                            </div>
                        );

                    case 'true-false':
                        return (
                            <div>
                                {[true, false].map((value) => (
                                    <div
                                        key={value.toString()}
                                        className={`option ${answers[question.id] === value ? 'selected' : ''}`}
                                        onClick={() => handleAnswer(question.id, value)}
                                    >
                                        <input
                                            type="radio"
                                            checked={answers[question.id] === value}
                                            onChange={() => {}}
                                        />
                                        <span>{value ? 'True' : 'False'}</span>
                                    </div>
                                ))}
                            </div>
                        );

                    case 'multiple-select':
                        return (
                            <div>
                                {question.options.map((option, idx) => (
                                    <div
                                        key={idx}
                                        className={`option ${(answers[question.id] || []).includes(idx) ? 'selected' : ''}`}
                                        onClick={() => {
                                            const current = answers[question.id] || [];
                                            const updated = current.includes(idx)
                                                ? current.filter(i => i !== idx)
                                                : [...current, idx];
                                            handleAnswer(question.id, updated);
                                        }}
                                    >
                                        <input
                                            type="checkbox"
                                            checked={(answers[question.id] || []).includes(idx)}
                                            onChange={() => {}}
                                        />
                                        <span>{option}</span>
                                    </div>
                                ))}
                            </div>
                        );

                    case 'matching':
                        return (
                            <div className="matching-container">
                                <div className="matching-column">
                                    <h4 style={{marginBottom: '15px', color: '#667eea'}}>Terms</h4>
                                    {question.pairs.map((pair, idx) => (
                                        <div key={idx} className="matching-item">
                                            <strong>{pair.left}</strong>
                                            <select
                                                className="matching-select"
                                                value={answers[question.id]?.[idx] || ''}
                                                onChange={(e) => {
                                                    const current = answers[question.id] || [];
                                                    const updated = [...current];
                                                    updated[idx] = e.target.value;
                                                    handleAnswer(question.id, updated);
                                                }}
                                            >
                                                <option value="">Select a match...</option>
                                                {question.pairs.map((p, i) => (
                                                    <option key={i} value={p.right}>{p.right}</option>
                                                ))}
                                            </select>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        );

                    case 'sequence':
                        const currentOrder = answers[question.id] || question.items.map((_, i) => i);
                        return (
                            <div className="sequence-container">
                                <p style={{marginBottom: '15px', color: '#666'}}>
                                    Click and drag to reorder the items from first to last:
                                </p>
                                {currentOrder.map((itemIdx, position) => (
                                    <div key={position} className="sequence-item">
                                        <div className="sequence-number">{position + 1}</div>
                                        <span>{question.items[itemIdx]}</span>
                                        <div style={{marginLeft: 'auto', display: 'flex', gap: '5px'}}>
                                            <button
                                                onClick={() => {
                                                    if (position > 0) {
                                                        const newOrder = [...currentOrder];
                                                        [newOrder[position], newOrder[position - 1]] = 
                                                        [newOrder[position - 1], newOrder[position]];
                                                        handleAnswer(question.id, newOrder);
                                                    }
                                                }}
                                                style={{
                                                    padding: '5px 10px',
                                                    cursor: 'pointer',
                                                    border: 'none',
                                                    background: '#667eea',
                                                    color: 'white',
                                                    borderRadius: '4px'
                                                }}
                                                disabled={position === 0}
                                            >
                                                ‚Üë
                                            </button>
                                            <button
                                                onClick={() => {
                                                    if (position < currentOrder.length - 1) {
                                                        const newOrder = [...currentOrder];
                                                        [newOrder[position], newOrder[position + 1]] = 
                                                        [newOrder[position + 1], newOrder[position]];
                                                        handleAnswer(question.id, newOrder);
                                                    }
                                                }}
                                                style={{
                                                    padding: '5px 10px',
                                                    cursor: 'pointer',
                                                    border: 'none',
                                                    background: '#667eea',
                                                    color: 'white',
                                                    borderRadius: '4px'
                                                }}
                                                disabled={position === currentOrder.length - 1}
                                            >
                                                ‚Üì
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        );

                    case 'fill-blank':
                        return (
                            <div>
                                <p style={{marginBottom: '20px', color: '#666'}}>
                                    Fill in the blanks below:
                                </p>
                                {question.blanks.map((_, idx) => (
                                    <div key={idx} style={{marginBottom: '15px'}}>
                                        <label style={{display: 'block', marginBottom: '5px', fontWeight: '600'}}>
                                            Blank {idx + 1}:
                                        </label>
                                        <input
                                            type="text"
                                            className="fill-blank-input"
                                            value={answers[question.id]?.[idx] || ''}
                                            onChange={(e) => {
                                                const current = answers[question.id] || [];
                                                const updated = [...current];
                                                updated[idx] = e.target.value;
                                                handleAnswer(question.id, updated);
                                            }}
                                            placeholder={`Enter answer for blank ${idx + 1}`}
                                        />
                                    </div>
                                ))}
                            </div>
                        );

                    default:
                        return null;
                }
            };

            if (stage === 'welcome') {
                return (
                    <div className="container">
                        <div className="header">
                            <h1>üè• Comprehensive Trauma Assessment</h1>
                            <p>Orthopaedic Injuries & Environmental Emergencies</p>
                        </div>
                        <div className="welcome-screen">
                            <h2>Welcome to Your Trauma Assessment</h2>
                            <p>
                                This comprehensive examination consists of <strong>50 questions</strong> covering 
                                Chapter 33 (Orthopaedic Injuries) and Chapter 34 (Environmental Emergencies).
                            </p>
                            <p>
                                You will encounter various question types including:
                            </p>
                            <ul style={{marginLeft: '30px', marginBottom: '20px', lineHeight: '1.8'}}>
                                <li>Multiple Choice Questions</li>
                                <li>True/False Questions</li>
                                <li>Multiple Select Questions</li>
                                <li>Matching Questions</li>
                                <li>Sequence/Ordering Questions</li>
                                <li>Fill in the Blank Questions</li>
                            </ul>
                            <p>
                                Upon completion, you will receive your score and a downloadable 
                                <strong> Certificate of Completion</strong>.
                            </p>
                            <input
                                type="text"
                                className="name-input"
                                placeholder="Enter your full name"
                                value={studentName}
                                onChange={(e) => setStudentName(e.target.value)}
                                onKeyPress={(e) => e.key === 'Enter' && handleStartTest()}
                            />
                            <button className="btn" onClick={handleStartTest}>
                                Begin Assessment
                            </button>
                        </div>
                    </div>
                );
            }

            if (stage === 'test') {
                const question = questions[currentQuestion];
                const progress = ((currentQuestion + 1) / questions.length) * 100;

                return (
                    <div className="container">
                        <div className="header">
                            <h1>Trauma Assessment</h1>
                            <p>Student: {studentName}</p>
                        </div>
                        <div className="test-content">
                            <div className="progress-bar">
                                <div className="progress-fill" style={{width: `${progress}%`}}></div>
                            </div>
                            
                            <div className="question-card">
                                <div className="question-number">
                                    Question {currentQuestion + 1} of {questions.length}
                                </div>
                                <div className="question-text">
                                    {question.question}
                                </div>
                                {renderQuestion()}
                            </div>

                            {showValidation && (
                                <div className="alert">
                                    ‚ö†Ô∏è Please answer the question before proceeding.
                                </div>
                            )}

                            <div className="navigation">
                                <button 
                                    className="btn" 
                                    onClick={handlePrevious}
                                    disabled={currentQuestion === 0}
                                >
                                    ‚Üê Previous
                                </button>
                                <button 
                                    className="btn" 
                                    onClick={handleNext}
                                >
                                    {currentQuestion === questions.length - 1 ? 'Submit Test' : 'Next ‚Üí'}
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (stage === 'results') {
                const percentage = Math.round((score / questions.length) * 100);
                const passed = percentage >= 70;

                return (
                    <div className="container">
                        <div className="header">
                            <h1>üéì Test Complete!</h1>
                            <p>Comprehensive Trauma Assessment Results</p>
                        </div>
                        <div className="results-screen">
                            <div className="results-summary">
                                <div className="score-circle">
                                    <div className="score">{percentage}%</div>
                                    <div className="label">Your Score</div>
                                </div>
                                <h2 style={{color: passed ? '#28a745' : '#dc3545', marginTop: '20px'}}>
                                    {passed ? '‚úì Passed' : '‚úó Not Passed'}
                                </h2>
                            </div>

                            <div className="results-details">
                                <div className="result-item">
                                    <span><strong>Questions Answered:</strong></span>
                                    <span>{questions.length}</span>
                                </div>
                                <div className="result-item">
                                    <span><strong>Correct Answers:</strong></span>
                                    <span style={{color: '#28a745', fontWeight: '700'}}>{score}</span>
                                </div>
                                <div className="result-item">
                                    <span><strong>Incorrect Answers:</strong></span>
                                    <span style={{color: '#dc3545', fontWeight: '700'}}>{questions.length - score}</span>
                                </div>
                                <div className="result-item">
                                    <span><strong>Passing Score:</strong></span>
                                    <span>70%</span>
                                </div>
                            </div>

                            <div className="certificate-preview">
                                <div style={{fontSize: '3rem'}}>üèÜ</div>
                                <div className="certificate-title">Certificate Preview</div>
                                <div className="certificate-text">This certifies that</div>
                                <div className="certificate-name">{studentName}</div>
                                <div className="certificate-text">
                                    has completed the Comprehensive Trauma Assessment
                                    <br />
                                    with a score of <strong>{score}/50 ({percentage}%)</strong>
                                </div>
                                <div style={{marginTop: '20px', color: '#888'}}>
                                    {new Date().toLocaleDateString('en-US', { 
                                        year: 'numeric', 
                                        month: 'long', 
                                        day: 'numeric' 
                                    })}
                                </div>
                            </div>

                            <div style={{textAlign: 'center', marginTop: '30px'}}>
                                <button className="btn" onClick={downloadCertificate}>
                                    üì• Download Certificate (PDF)
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }
        }

        ReactDOM.render(<TraumaTest />, document.getElementById('root'));
    </script>
</body>
</html>